<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>WebGL Demo</title>
    <link rel="stylesheet" href="./webgl.css" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js"></script>
    <script src="webgl-demo.js" defer></script>

     <!-- vertex shader -->
     <script id="vertex-shader" type="x-shader/x-vertex">
      attribute vec2 vPosition;
      varying highp vec2 blurTextureCoords[9];
      uniform highp vec2 pixelSize;
      uniform int stage;
      uniform int flipY;

      //uniform highp float offset[5];
      //uniform highp float weight[5];

      void main(void) {
        gl_Position = vec4(vPosition,0.0,1.0);
        highp vec2 uv; 
        
        uv = vPosition; 
        uv.y = uv.y * float(flipY); 
        uv = uv*0.5+0.5; 

        for(int i=-4; i<=4; i++){
            float i_float = float(i);
            if( mod(float(stage), 2.0) == 0.0){
              blurTextureCoords[i+4] = uv + vec2(pixelSize.x * i_float,0.0);
            }
            else{
              blurTextureCoords[i+4] = uv + vec2(0.0, pixelSize.y * i_float);
            }            
        }
      }
    </script>

    <!-- fragment shader -->
    <script  id="fragment-shader" type="x-shader/x-fragment">
        varying highp vec2 blurTextureCoords[9];
        uniform sampler2D videoTexture;  // Tells the shader whcih texture unit  to use. 0 by default.

        void main(void){    
          highp vec4 sum = vec4(0.0);

          // http://dev.theomader.com/gaussian-kernel-calculator/
          // sigma = 3, kernel size= 9

          sum += texture2D(videoTexture, blurTextureCoords[0]) * 0.028532;
          sum += texture2D(videoTexture, blurTextureCoords[1]) * 0.067234;
          sum += texture2D(videoTexture, blurTextureCoords[2]) * 0.124009;
          sum += texture2D(videoTexture, blurTextureCoords[3]) * 0.179044;

          sum += texture2D(videoTexture, blurTextureCoords[4]) * 0.20236;
          
          sum += texture2D(videoTexture, blurTextureCoords[5]) * 0.179044;
          sum += texture2D(videoTexture, blurTextureCoords[6]) * 0.124009;
          sum += texture2D(videoTexture, blurTextureCoords[7]) * 0.067234;
          sum += texture2D(videoTexture, blurTextureCoords[8]) * 0.028532;

          gl_FragColor = vec4(sum.rgb, 1.0);
        }
    </script> 
  </head>

  <body>
    <div id="fps"></div>
    <div id="radius" class="slider">
      <label>offset</label>
      <input id="radius_input" class="slider_range" type="range" value="1" min="0" max="6">
      <output id="radius_value" class="slider_value">1</output>
    </div>    

    <div id="rounds" class="slider">
      <label>rounds</label>
          <input id="rounds_input" class="slider_range" type="range" value="5" min="1" max="30">
      <output id="rounds_value" class="slider_value">5</output>
    </div>    

    <div id="downscale" class="slider">
      <label>downscale</label>
          <input id="downscale_input" class="slider_range" type="range" value="4" min="1" max="10">
      <output id="downscale_value" class="slider_value">4</output>
    </div>    


    <canvas id="glcanvas"></canvas>
    
    

  </body>
</html>